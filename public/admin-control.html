<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Automation Control Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #333;
        }
        
        .control-panel {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .control-panel h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .slider-value {
            display: inline-block;
            margin-left: 10px;
            padding: 5px 10px;
            background: #f7fafc;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .checkbox-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: normal;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
        }
        
        .keyword-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .keyword-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .tag {
            padding: 5px 15px;
            background: #edf2f7;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .tag button {
            background: none;
            border: none;
            color: #e53e3e;
            cursor: pointer;
            font-size: 18px;
        }
        
        .content-queue {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .content-queue h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .queue-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .queue-filters select,
        .queue-filters button {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            background: white;
            cursor: pointer;
        }
        
        .queue-filters button {
            background: #667eea;
            color: white;
            border: none;
        }
        
        .queue-filters button:hover {
            background: #5a67d8;
        }
        
        .content-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .content-table th,
        .content-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .content-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }
        
        .content-table tr:hover {
            background: #f7fafc;
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-approve {
            background: #48bb78;
            color: white;
        }
        
        .btn-reject {
            background: #f56565;
            color: white;
        }
        
        .btn-enrich {
            background: #4299e1;
            color: white;
        }
        
        .save-btn {
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .save-btn:hover {
            background: #5a67d8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Content Automation Control Panel</h1>
            <p>Fine-tune your content discovery and enrichment pipeline</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total Content</h3>
                <div class="value" id="total-content">0</div>
            </div>
            <div class="stat-card">
                <h3>Pending Review</h3>
                <div class="value" id="pending-content">0</div>
            </div>
            <div class="stat-card">
                <h3>Approved</h3>
                <div class="value" id="approved-content">0</div>
            </div>
            <div class="stat-card">
                <h3>Avg Score</h3>
                <div class="value" id="avg-score">0</div>
            </div>
            <div class="stat-card">
                <h3>Enriched</h3>
                <div class="value" id="enriched-content">0</div>
            </div>
        </div>

        <div class="control-panel">
            <h2>‚öôÔ∏è Content Criteria & Thresholds</h2>
            
            <div class="control-group">
                <label>Minimum Content Score: <span class="slider-value" id="score-value">50</span></label>
                <input type="range" class="slider" id="min-score" min="0" max="100" value="50">
            </div>

            <div class="control-group">
                <label>Minimum Description Length: <span class="slider-value" id="desc-value">50</span> chars</label>
                <input type="range" class="slider" id="min-desc" min="10" max="500" value="50" step="10">
            </div>

            <div class="control-group">
                <label>Quality Threshold: <span class="slider-value" id="quality-value">70</span>%</label>
                <input type="range" class="slider" id="quality-threshold" min="0" max="100" value="70">
            </div>

            <div class="control-group">
                <label>Auto-Approve Score: <span class="slider-value" id="auto-value">85</span></label>
                <input type="range" class="slider" id="auto-approve" min="50" max="100" value="85">
            </div>

            <div class="control-group">
                <label>Required Keywords (comma-separated):</label>
                <input type="text" class="keyword-input" id="keyword-input" placeholder="e.g. AI, blockchain, web3">
                <div class="keyword-tags" id="keyword-tags"></div>
            </div>

            <div class="control-group">
                <label>Enrichment Options:</label>
                <div class="checkbox-group">
                    <label>
                        <input type="checkbox" id="ai-analysis" checked>
                        AI Analysis
                    </label>
                    <label>
                        <input type="checkbox" id="sentiment">
                        Sentiment Analysis
                    </label>
                    <label>
                        <input type="checkbox" id="keywords">
                        Keyword Extraction
                    </label>
                    <label>
                        <input type="checkbox" id="category">
                        Category Prediction
                    </label>
                    <label>
                        <input type="checkbox" id="summary">
                        Auto-Summarization
                    </label>
                </div>
            </div>

            <div class="control-group">
                <label>Blocked Domains (one per line):</label>
                <textarea class="keyword-input" id="blocked-domains" rows="3" placeholder="spam-site.com"></textarea>
            </div>

            <button class="save-btn" onclick="saveSettings()">üíæ Save Settings</button>
        </div>

        <div class="content-queue">
            <h2>üìã Content Queue</h2>
            
            <div class="queue-filters">
                <select id="status-filter">
                    <option value="">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="approved">Approved</option>
                    <option value="rejected">Rejected</option>
                </select>
                
                <select id="type-filter">
                    <option value="">All Types</option>
                    <option value="article">Articles</option>
                    <option value="video">Videos</option>
                    <option value="podcast">Podcasts</option>
                    <option value="research">Research</option>
                </select>
                
                <button onclick="refreshQueue()">üîÑ Refresh</button>
                <button onclick="runDiscovery()">üîç Run Discovery</button>
            </div>

            <table class="content-table">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Source</th>
                        <th>Type</th>
                        <th>Score</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="content-tbody">
                    <!-- Content will be loaded here -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_BASE = window.location.origin;
        let keywords = [];

        // Initialize sliders
        document.querySelectorAll('.slider').forEach(slider => {
            slider.addEventListener('input', (e) => {
                const valueSpan = document.getElementById(e.target.id.replace('-', '-value').replace('min-', ''));
                if (valueSpan) valueSpan.textContent = e.target.value;
            });
        });

        // Keyword management
        document.getElementById('keyword-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const input = e.target;
                const keyword = input.value.trim();
                if (keyword) {
                    keywords.push(keyword);
                    updateKeywordTags();
                    input.value = '';
                }
            }
        });

        function updateKeywordTags() {
            const container = document.getElementById('keyword-tags');
            container.innerHTML = keywords.map((k, i) => 
                `<div class="tag">${k} <button onclick="removeKeyword(${i})">√ó</button></div>`
            ).join('');
        }

        function removeKeyword(index) {
            keywords.splice(index, 1);
            updateKeywordTags();
        }

        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/api/dashboard`);
                const data = await response.json();
                
                document.getElementById('total-content').textContent = data.total || 0;
                document.getElementById('pending-content').textContent = data.pending || 0;
                document.getElementById('approved-content').textContent = data.approved || 0;
                document.getElementById('avg-score').textContent = Math.round(data.avgScore || 0);
                document.getElementById('enriched-content').textContent = data.enriched || 0;
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        async function refreshQueue() {
            try {
                const status = document.getElementById('status-filter').value;
                const type = document.getElementById('type-filter').value;
                
                const params = new URLSearchParams();
                if (status) params.append('status', status);
                if (type) params.append('type', type);
                
                const response = await fetch(`${API_BASE}/api/dashboard?${params}`);
                const data = await response.json();
                
                const tbody = document.getElementById('content-tbody');
                tbody.innerHTML = (data.items || []).map(item => `
                    <tr>
                        <td>${item.title}</td>
                        <td>${item.source}</td>
                        <td>${item.type}</td>
                        <td>${item.score}</td>
                        <td>${item.status}</td>
                        <td class="actions">
                            <button class="btn btn-approve" onclick="approveContent('${item.id}')">‚úì</button>
                            <button class="btn btn-reject" onclick="rejectContent('${item.id}')">‚úó</button>
                            <button class="btn btn-enrich" onclick="enrichContent('${item.id}')">‚ö°</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Failed to load queue:', error);
            }
        }

        async function approveContent(id) {
            await fetch(`${API_BASE}/api/admin`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: 'approve', ids: [id]})
            });
            refreshQueue();
        }

        async function rejectContent(id) {
            await fetch(`${API_BASE}/api/admin`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({action: 'reject', ids: [id]})
            });
            refreshQueue();
        }

        async function enrichContent(id) {
            const options = {
                aiAnalysis: document.getElementById('ai-analysis').checked,
                sentiment: document.getElementById('sentiment').checked,
                keywords: document.getElementById('keywords').checked,
                category: document.getElementById('category').checked,
                summary: document.getElementById('summary').checked
            };
            
            await fetch(`${API_BASE}/api/enrich`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({id, options})
            });
            refreshQueue();
        }

        async function runDiscovery() {
            const response = await fetch(`${API_BASE}/api/run`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({source: 'manual'})
            });
            const data = await response.json();
            alert(`Discovery complete! Found ${data.found || 0} new items.`);
            refreshQueue();
        }

        function saveSettings() {
            const settings = {
                minScore: document.getElementById('min-score').value,
                minDescription: document.getElementById('min-desc').value,
                qualityThreshold: document.getElementById('quality-threshold').value,
                autoApproveScore: document.getElementById('auto-approve').value,
                keywords: keywords,
                blockedDomains: document.getElementById('blocked-domains').value.split('\n').filter(d => d),
                enrichmentOptions: {
                    aiAnalysis: document.getElementById('ai-analysis').checked,
                    sentiment: document.getElementById('sentiment').checked,
                    keywords: document.getElementById('keywords').checked,
                    category: document.getElementById('category').checked,
                    summary: document.getElementById('summary').checked
                }
            };
            
            localStorage.setItem('contentSettings', JSON.stringify(settings));
            alert('Settings saved successfully!');
        }

        // Load on startup
        loadStats();
        refreshQueue();
        setInterval(loadStats, 30000); // Refresh stats every 30 seconds
    </script>
</body>
</html>